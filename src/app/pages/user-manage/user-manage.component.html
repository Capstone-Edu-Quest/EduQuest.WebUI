<div class="users-manage">
  <div class="title text-gradient">{{ "LABEL.USERS_MANAGE" | translate }}</div>

  <div class="statistics">
    <div class="stats-ctn">
      <div class="stat" *ngFor="let stat of statItems">
        <div class="header">
          <label>{{ stat.label | translate }}</label>
          <fa-icon [icon]="stat.icon"></fa-icon>
        </div>
        <div class="value">{{ stat.value.toLocaleString() }}</div>
      </div>
    </div>

    <div class="graph">
      <app-line-chart
        [labels]="graphLabels"
        [dataSet]="graphData"
      ></app-line-chart>
    </div>
  </div>

  <div style="margin-top: 30px">
    <div style="margin-bottom: 8px; font-weight: 600; font-size: 13px">
      {{ "LABEL.APPLIED_INSTRUCTOR" | translate }}
    </div>
    <app-table
      *ngIf="isAppliedInsReady"
      [columns]="appliedInstructorColumns"
      [data]="appliedInstructor"
      (onRowClick)="onViewInstructorRegisterInfo($event)"
    ></app-table>
  </div>

  <div class="users-list">
    <div class="search-ctn">
      <nz-input-group [nzSuffix]="suffixIconButton" style="width: 50%">
        <input
          [(ngModel)]="searchText"
          (keydown)="onConfirmSearch($event)"
          nz-input
          placeholder="{{ 'LABEL.SEARCH_USERS' | translate }}"
        />
      </nz-input-group>

      <ng-template #suffixIconButton>
        <i nz-icon nzType="search" style="color: var(--secondary-text)"></i>
      </ng-template>
    </div>
    <app-table
      (onRowClick)="onViewDetails($event)"
      [columns]="columns"
      [data]="usersTableData"
    ></app-table>
  </div>
</div>

<ng-template #actionOnUser let-row="row">
  <div style="display: flex; gap: 8px">
    <app-button (click)="onWarn($event, row)">{{
      "BUTTON.WARN" | translate
    }}</app-button>
    <app-button (click)="onSuspend($event, row)" type="danger">{{
      "BUTTON.SUSPEND" | translate
    }}</app-button>
  </div>
</ng-template>

<ng-template #roleManagement let-row="row">
  <select class="role-manage" (click)="$event.stopPropagation()">
    <option
      *ngFor="let opt of roleOptions"
      [value]="opt.value"
      [attr.selected]="row.roleId === opt.value ? true : null"
    >
      {{ opt.label | translate }}
    </option>
  </select>
</ng-template>

<ng-template #assignToExpert let-row="row">
  <select
    style="
      padding: 3px;
      background: var(--quaternary-bg);
      outline: none;
      border: var(--quaternary-text);
      border-radius: 5px;
      color: var(--primary-text);
      min-width: 120px;
    "
    (change)="onAssignExpert($event, row)"
    [(ngModel)]="row.expertId"
  >
    <option></option>
    <option *ngFor="let expert of expertsList" [value]="expert.id">
      {{ expert.username }}
    </option>
  </select>
</ng-template>

<ng-template #approval let-row="row">
  <div class="ref-btns-ctn" style="display: flex; gap: 8px">
    <fa-icon
      (click)="onUpdateStatus($event, row, true)"
      [icon]="acceptIcon"
      style="color: var(--success); cursor: pointer"
    ></fa-icon>
    <fa-icon
      (click)="onUpdateStatus($event, row, false)"
      [icon]="rejectIcon"
      style="color: var(--alert); cursor: pointer"
    ></fa-icon>
  </div>
</ng-template>
